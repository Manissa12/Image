# ğŸ”¹ Choisis un code titre Ã  tester :
code_test = "AA33SP528"  # <-- remplace par un code connu dans ta table

# 1ï¸âƒ£ VÃ©rifie qu'il existe dans TITRES
df_titre_match = df_Titres.loc[df_Titres["ID_TITRE2"] == code_test]

if df_titre_match.empty:
    print(f"âŒ Le code titre '{code_test}' n'existe pas dans df_Titres.")
else:
    titre_row = df_titre_match.iloc[0]
    tiers_titres = str(titre_row["TIERS_EMETTEUR"]).strip()
    print(f"Tiers Ã©metteur (Titres) : {tiers_titres}")

    # 2ï¸âƒ£ Cherche le mÃªme code dans DIMENSION
    df_dim_match = df_Dimension.loc[df_Dimension["Security ID CODA"] == code_test]
    if df_dim_match.empty:
        print(f"âš ï¸ Pas trouvÃ© dans df_Dimension pour {code_test}")
    else:
        dim_row = df_dim_match.iloc[0]
        issuer_dim = str(dim_row["Issuer"]).strip()
        print(f"Issuer (Dimension) : {issuer_dim}")

        # 3ï¸âƒ£ Liste des transcos possibles
        transcos_possibles = (
            df_Transco_tiers.loc[df_Transco_tiers["Transco 1"] == issuer_dim, "Code 2"]
            .astype(str).str.strip().unique().tolist()
        )
        print(f"Transcos possibles pour {issuer_dim} : {transcos_possibles}")

        # 4ï¸âƒ£ VÃ©rification
        is_ok = str(tiers_titres) in transcos_possibles
        print(f"RÃ©sultat du test pour {code_test} â†’ {'âœ… OK' if is_ok else 'âŒ KO'}")
