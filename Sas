LEFT JOIN (
    SELECT 
        R.ROL_TIE_ID AS TIE_ID,
        MAX(RS.DATE_FIN_VALIDITE) AS DATE_FIN_VALIDITE
    FROM CODA2.TREF_ROLE R
    INNER JOIN CODA2.TREF_ROLE_SOCIETE RS
        ON RS.ROL_ROLE_ID = R.ROL_ID
    GROUP BY R.ROL_TIE_ID
) AS MAX_DATE_FIN
ON MAX_DATE_FIN.TIE_ID = T1.TIE_ID
